<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#121212">
    <title>S…ØŒ±…æŒ±‚Ñ¢ By üïäùêìùêïùêìùêûùê•ùêÆùê†ùêÆ‚Ñ¢</title>
    <link rel="icon" type="image/x-icon" href="https://tvtelugu.github.io/images/tvtelugu.ico">
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Parkinson&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Anek+Telugu:wght@400;700&display=swap" rel="stylesheet">
    <style>
       /* General Reset and Layout */
        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Parkinson', sans-serif;
            background-color: #121212;
            color: white;
            height: 100%;
            overflow: hidden;
        }

        /* Loader Styles */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #121212;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loader .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Hide loader when page is loaded */
        .hide-loader {
            display: none;
        }

        /* Main Layout */
        .container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        /* Header */
        #header {
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: #1F1F1F;
            justify-content: space-between;
        }

        /* Logo Container */
        #logo-container {
        display: flex;              /* Use flexbox for side-by-side layout */
        align-items: center;        /* Vertically center the items */
    }

        /* Page Logo */
        #page-logo {
            width: 40px;
            height: 40px;
            padding: 5px
            object-fit: contain;
        }

        #logo-text {
            font-size: 18px;            /* Set the font size for the text */
            font-weight: bold;          /* Optional: make the text bold */
            color: White;             /* Optional: set a color for the text */
         }

        /* Search Bar */
        #search-container {
            display: flex;
            align-items: center;
            background-color: #333;
            border-radius: 20px;
            padding: 5px 8px;
            width: 200px;
            gap: 10px;
            transition: all 0.3s ease;
        }

       #search-bar {
    background: none;
    border: none;
    color: white;
    font-size: 14px;
    outline: none;
    padding: 0 8px 0 10px; /* Adjust padding to allow space for the button */
    width: 100%;
    height: 100%;
}

#search-btn {
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    height: 100%;
    width: 40px; /* Adjust the size of the button */
}

        /* Main Player */
        #player-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            flex: 1;
            overflow-y: auto;
        }

* Animated Record Cover Art */
@keyframes rotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Album Image */
#album-poster {
    width: 350px;
    height: 350px;
    background-size: cover;
    background-position: center;
    border-radius: 50%;
    margin-bottom: 15px;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    animation: rotate 20s linear infinite;
}

/* Lyrics Section */
#lyrics-container {
    font-family: 'Anek Telugu', sans-serif;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 98%;
    text-align: center;
    color: #bbb;
    font-size: 14px;
    z-index: 10;
    padding: 10px;
    background-color: rgba(0, 0, 0, 0.4);
    border-radius: 15px;
    backdrop-filter: blur(8px);
    overflow-y: auto;
    max-height: 98%;
    scroll-behavior: smooth;
}

/* Lyrics Text */
#lyrics-text {
    white-space: pre-line;
    font-size: 14px;
    color: white;
    line-height: 1.5;
}

/* Highlighted Lyrics */
.highlight {
    color: #ffffff;
    font-weight: none;
}

/* Hide the scroll bar */
#lyrics-container::-webkit-scrollbar {
    display: none;
}

       /* Song Info */
        #song-info {
            text-align: center;
            margin-bottom: 20px;
        }

        #song-name {
            font-size: 22px;
            font-weight: bold;
            margin: 10px 0;
        }

        #song-artist {
            font-size: 16px;
            color: #999;
        }

        #album-name {
            font-size: 14px;
            font-weight: bold;
            color: #888;
            margin-top: 5px;
        }

        /* Song List */
        #song-list {
            width: 100%;
            padding: 10px;
            background-color: #1F1F1F;
            border-radius: 10px;
            margin-bottom: 20px;
            border: none;
            color: white;
        }

        /* Controls */
        #controls {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 20px;
        }

        #controls button {
            background: none;
            border: none;
            color: white;
            font-size: 40px;
            cursor: pointer;
        }


       .refresh-button {
        font-size: 24px;
        color: white;
        border: none;
        background: transparent;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-right: 2px; /* Space between refresh button and search bar */
    }
        
/* Container for progress bar and time display */
.progress-container {
    display: flex;
    align-items: center;
    justify-content: space-between; /* Optional: If you want space between the elements */
    width: 100%;
}

/* Progress Bar */
#progress-bar {
    width: 100%;  /* Adjust the width if needed */
    height: 10px;
    background-color: #333;
    border-radius: 5px;
    margin-right: 10px;  /* Space between the progress bar and time display */
    outline: none;
    cursor: pointer;
}

#progress-bar::-webkit-slider-thumb {
    background: #FF4081;
    border: none;
    height: 20px;
    width: 20px;
    border-radius: 50%;
    cursor: pointer;
}

/* Time Display */
#time-display {
    font-size: 14px;
    color: #FFF;
}

        /* Quality Dropdown */
        #quality-select {
            background-color: #1F1F1F;
            color: white;
            border: none;
            padding: 8px;
            border-radius: 5px;
            font-size: 16px;
            margin-top: 15px;
        }

        /* Shuffle and Download Icon */
        #shuffle-btn {
            font-size: 30px;
            color: white;
            cursor: pointer;
            margin-right: 20px;
        }

        #downloadButton {
            font-size: 30px;
            color: white;
            cursor: pointer;
        }

         #controls-row {
            display: flex;
            justify-content: space-between; /* Space out elements */
            align-items: center; /* Align vertically */
        }

        #song-list, #quality-select {
             margin: 0 10px; /* Optional: add space between the dropdowns */
        }
        
     /* Footer Styling */
    .footer {
      text-align: center;
      padding: 10px 0;
      background: transparent;
      color: white;
      font-size: 14px;
    }

    .footer a {
      color: white;
    }

    .footer a:hover {
      color: #ffcc00;
    }

        #radio-switch {
          position: absolute;
    right: 250px;
    top: 18px;
    }
    .radio-button {
        text-decoration: none;
        color: inherit;
        font-size: 24px;
    }
    .radio-button:hover {
        color: #ff5722; /* Optional hover effect */
    }

        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {

#search-container {
    display: flex; /* Ensure search bar and button align in a row */
    width: 150px;
    height: 25px; /* Adjust the height of the container */
}

#search-bar {
    background: none;
    border: none;
    color: white;
    font-size: 14px;
    outline: none;
    padding: 0 6px 0 8px; /* Adjust padding to allow space for the button */
    width: 100%;
    height: 100%;
}

#search-btn {
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    height: 100%;
    width: 40px; /* Adjust the size of the button */
}

     #radio-switch {
      position: absolute;
      right: 200px;
      top: 18px;
    }
    .radio-button {
        text-decoration: none;
        color: inherit;
        font-size: 24px;
    }
    .radio-button:hover {
        color: #ff5722; /* Optional hover effect */
    }

            
            #song-list {
                width: 90%;
            }

            #song-name {
                font-size: 18px;
            }

            #song-artist {
                font-size: 14px;
            }

            #controls button {
                font-size: 30px;
            }

            #quality-select {
                font-size: 14px;
            }

            #album-poster {
                width: 350px;
                height: 350px;
            }

            #downloadButton {
                font-size: 20px;
            }
        }

        /* Hide audio element */
        #audio {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
    </div>

    <div class="container" id="content" class="hide-loader">

<!-- Header -->
<div id="header">
    <div id="logo-container">
        <img src="https://tvtelugu.github.io/images/tvtelugu.ico" alt="Logo" id="page-logo" />
        <span id="logo-text">S…ØŒ±…æŒ±‚Ñ¢</span>
    </div>

    <div id="search-container">
        <!-- Page Refresh Button -->
        <button class="refresh-button" onclick="window.location.reload();">
            <span class="material-icons">refresh</span>
        </button>

        <!-- Search Bar -->
        <input type="text" id="search-bar" placeholder="Search..." onkeyup="searchSongs(this.value)" />
        
        <!-- Search Button -->
        <button id="search-btn">
            <i class="material-icons">search</i>
        </button>
    </div>

    <!-- Radio Page Switch Button (Moved here) -->
    <div id="radio-switch">
        <a href="https://tvt-beryl.vercel.app/radio.html" class="radio-button">
            <span class="material-icons">radio</span>
        </a>
    </div>
</div>
        <!-- Main Player -->
        <div id="player-container">

           <!-- Album Poster -->
        <div id="album-poster" onclick="toggleLyrics()">
        <div id="lyrics-container">
        <div id="lyrics-text">Loading lyrics...</div>
       </div>
</div>

            <!-- Song Info -->
            <div id="song-info">
               <p><span id="song-name">Song Name</span></p>
                  <span id="song-artist">Artist Name</span> <span> - </span>
                  <span id="album-name">Album Name</span>
            </div>

            <!-- Controls -->
            <div id="controls">
                <button id="shuffle-btn" onclick="shufflePlaylist()">
                    <i class="material-icons">shuffle</i>
                </button>
                <button id="prev" onclick="prevSong()">
                    <i class="material-icons">skip_previous</i>
                </button>
                <button id="play" onclick="togglePlay()">
                    <i class="material-icons" id="play-icon">play_arrow</i>
                </button>
                <button id="next" onclick="nextSong()">
                    <i class="material-icons">skip_next</i>
                </button>
                <button id="downloadButton" onclick="downloadAudio()">
                    <i class="material-icons">download</i>
                </button>
            </div>

            <!-- Progress Bar -->
            <div class="progress-container">
            <input type="range" id="progress-bar" value="0" max="100" onchange="seekSong()" />
            <span id="time-display">0:00</span>
            </div>
<p></p>
            <!-- Song List and Quality Dropdown -->
            <div id="controls-row">
                <select id="song-list" onchange="playSong()">
                    <option value="">Select a song</option>
                </select>
                <select id="quality-select" onchange="changeQuality()">
                    <option value="12">Low Quality</option>
                    <option value="48">Medium Quality</option>
                    <option value="96">High Quality</option>
                    <option value="160" selected>Very High Quality</option>
                    <option value="320">Ultra High Quality</option>
                </select>
            </div>

        </div>
 <!-- Footer -->
    <footer class="footer">
      <p>
        ¬© ùüêùüéùüêùüí || S…ØŒ±…æŒ±‚Ñ¢ Made with ‚ù§Ô∏è by <a href="https://t.me/tvtelugu" target="_blank">ùêåùêöùêùùê°ùêÆ</a>
      </p>
    </footer>
        
    </div>

    <!-- Audio Player -->
    <audio id="audio" controls></audio>

    <script>
function toggleLyrics() {
    const lyricsContainer = document.getElementById("lyrics-container");
    lyricsContainer.style.display = lyricsContainer.style.display === "flex" ? "none" : "flex";
}

const queries = [
    'Telugu', 'Telugu 90', 'Telugu 80', 'Telugu Old', 'Telugu retro', 'Telugu Devotional', 
    'Srinivasa Govinda', 'Sri Venkateshwara Suprabhatham', 'M. S. Subbulakshmi', 'P. Susheela',
    'Ghantasala', 'S. Janaki', 'Mano', 'Telugu Shreya Ghoshal', 'veturi sundararama murthy', 'veturi',
    'Telugu Devi Sri Prasad', 'Mani Sharma', 'Anoop Rubens',
    'S. P. Balasubrahmanyam', 'Ilaiyaraaja', 'Telugu K.J. Yesudas', 'Telugu M. M. Keeravani',
    'Annamayya Keerthana', 'Telugu G.V. Prakash Kumar', 'Telugu Anurag Kulkarni', 'Mahesh Babu',
    'Telugu Thaman S', 'Ram Miriyala', 'Bheems Ceciroleo', 'Telugu Yuvan Shankar Raja',
    'Ramajogayya Sastry', 'balagam', 'latest telugu', 'telugu folk', 'new telugu remix'
];

let audio = document.getElementById("audio");
let playIcon = document.getElementById("play-icon");
let songList = document.getElementById("song-list");
let progressBar = document.getElementById("progress-bar");
let timeDisplay = document.getElementById("time-display");
let qualitySelect = document.getElementById("quality-select");
let currentSongIndex = 0;
let songs = []; // Store song data from API response
let currentQuality = "160"; // Default to 160 kbps

// Auto-fetch random query and play the first song on page load
window.onload = async function () {
    const randomQuery = queries[Math.floor(Math.random() * queries.length)];
    await searchSongs(randomQuery);
    document.getElementById("loader").classList.add('hide-loader');
    document.getElementById("content").classList.remove('hide-loader');
};

// Fetch songs based on search query
async function searchSongs(query) {
    if (!query) return;

    let url = `https://saavn.dev/api/search/songs?query=${query}&page=1&limit=50`;
    const response = await fetch(url);
    const data = await response.json();
    songs = data.data.results;
    updateSongList();
}

// Fetch lyrics for the song and handle smart scrolling
async function fetchLyrics(songId) {
    const url = `https://saavn.dev/api/songs/${songId}/lyrics`;
    try {
        const response = await fetch(url);
        const data = await response.json();

        const lyricsContainer = document.getElementById("lyrics-container");
        const lyricsText = document.getElementById("lyrics-text");

        if (data.data) {
            const lyrics = data.data.lyrics.split('\n');
            let formattedLyrics = lyrics.map((line, index) => 
                `<p class="lyrics-line" id="line-${index}">${line}</p>`
            ).join('');
            lyricsText.innerHTML = formattedLyrics;
            lyricsContainer.style.display = 'block';

            // Initialize the first line as highlighted
            highlightCurrentLine(0);
        } else {
            lyricsText.innerText = 'Lyrics not available.';
            lyricsContainer.style.display = 'none';
        }
    } catch (error) {
        console.error('Error fetching lyrics:', error);
        // Prevent showing error message, instead hide lyrics container
        document.getElementById("lyrics-container").style.display = 'none';
    }
}

// Highlight the current line based on the song's current time
function highlightCurrentLine(lineIndex) {
    const lines = document.querySelectorAll('.lyrics-line');

    // Remove highlight from all lines
    lines.forEach(line => line.classList.remove('highlight'));

    // Add highlight to the current line
    const currentLine = lines[lineIndex];
    if (currentLine) {
        currentLine.classList.add('highlight');
        scrollToLine(currentLine);
    }
}

// Scroll to the current line
function scrollToLine(line) {
    const lyricsContainer = document.getElementById("lyrics-container");
    const offsetTop = line.offsetTop;
    const lineHeight = line.offsetHeight;

    // Adjust scroll position to center the current line in the container
    lyricsContainer.scrollTop = offsetTop - (lyricsContainer.offsetHeight / 2) + (lineHeight / 2);
}

// Update the highlighted line and scroll as the song progresses
audio.ontimeupdate = function () {
    let progress = (audio.currentTime / audio.duration) * 100;
    progressBar.value = progress;
    let minutes = Math.floor(audio.currentTime / 60);
    let seconds = Math.floor(audio.currentTime % 60);
    timeDisplay.innerText = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;

    // Determine which line to highlight based on the current time of the song
    const currentTimeInSeconds = Math.floor(audio.currentTime);
    const lyricsLines = document.querySelectorAll('.lyrics-line');
    let lineIndex = 0;

    // Find the line corresponding to the current time
    for (let i = 0; i < lyricsLines.length; i++) {
        const line = lyricsLines[i];
        const lineTime = parseInt(line.getAttribute('data-time'), 10); // Assuming each line has a data-time attribute
        if (lineTime <= currentTimeInSeconds) {
            lineIndex = i;
        }
    }

    highlightCurrentLine(lineIndex);
};

// Update song list dropdown
function updateSongList() {
    songList.innerHTML = "<option value=''>Select a song</option>";
    songs.forEach((song, index) => {
        const option = document.createElement("option");
        option.value = index;
        option.innerHTML = song.name;
        songList.appendChild(option);
    });

    if (songs.length > 0) {
        currentSongIndex = 0;
        loadSong();
        audio.play();
    }
}

// Update the selected song in the dropdown
function updateSongListSelection() {
    songList.value = currentSongIndex; // Set the current song in the dropdown
}

// Play selected song
function playSong() {
    if (songList.value !== "") {
        currentSongIndex = songList.value;
        loadSong();
        audio.play();
    }
}

// Load song info
function loadSong() {
    const song = songs[currentSongIndex];
    const selectedQuality = qualitySelect.value;
    const qualityUrl = song.downloadUrl.find(url => url.quality === `${selectedQuality}kbps`).url;

    audio.src = qualityUrl;
    // Remove quotes and HTML entities from song name, artist name, and album name
    document.getElementById("song-name").innerText = removeQuotes(song.name);
    document.getElementById("song-artist").innerText = removeQuotes(song.artists.primary[0].name);
    document.getElementById("album-name").innerText = removeQuotes(song.album.name);
    document.getElementById("album-poster").style.backgroundImage = `url(${song.image[2].url})`;
    playIcon.innerText = "pause";

    // Fetch lyrics
    fetchLyrics(song.id);

    // Update song list selection
    updateSongListSelection();
}

// Function to decode HTML entities and remove quotes
function decodeHtmlEntities(str) {
    const txt = document.createElement("textarea");
    txt.innerHTML = str;
    return txt.value; // This decodes HTML entities
}

// Function to remove quotes after decoding HTML entities
function removeQuotes(str) {
    const decodedStr = decodeHtmlEntities(str); // Decode the HTML entities
    return decodedStr.replace(/"/g, ''); // Remove the actual quotes
}

// Toggle play/pause
function togglePlay() {
    if (audio.paused) {
        audio.play();
        playIcon.innerText = "pause";
    } else {
        audio.pause();
        playIcon.innerText = "play_arrow";
    }
}

// Seek song based on progress bar
function seekSong() {
    const seekTo = audio.duration * (progressBar.value / 100);
    audio.currentTime = seekTo;
}

// Update progress bar as song plays
audio.ontimeupdate = function () {
    let progress = (audio.currentTime / audio.duration) * 100;
    progressBar.value = progress;
    let minutes = Math.floor(audio.currentTime / 60);
    let seconds = Math.floor(audio.currentTime % 60);
    timeDisplay.innerText = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
};

// Switch audio quality
function changeQuality() {
    if (audio.src) {
        loadSong();
        audio.play();
    }
}

// Previous song
function prevSong() {
    currentSongIndex = (currentSongIndex - 1 + songs.length) % songs.length;
    loadSong();
    audio.play();
}

// Next song
function nextSong() {
    currentSongIndex = (currentSongIndex + 1) % songs.length;
    loadSong();
    audio.play();
}

// Shuffle playlist
function shufflePlaylist() {
    songs.sort(() => Math.random() - 0.5);
    updateSongList();
}

// Download song
function downloadAudio() {
    const song = songs[currentSongIndex];
    const audioUrl = song.downloadUrl[4].url; // Adjust index if needed

    fetch(audioUrl)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.blob();
        })
        .then(blob => {
            const blobUrl = URL.createObjectURL(blob);

            // Sanitize the song name to remove existing extensions
            const sanitizedSongName = song.name.replace(/\.[^/.]+$/, '');
            const a = document.createElement('a');
            a.href = blobUrl;
            a.download = `${sanitizedSongName}.mp3`; // Always use .mp3 extension

            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            URL.revokeObjectURL(blobUrl);
        })
        .catch(error => {
            console.error('Error downloading audio:', error);
        });
}

// Automatically play the next song when the current song ends
audio.addEventListener('ended', function () {
    nextSong();
});

// Installable PWA logic
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    // Add a button to notify the user about installability
});

document.getElementById('installBtn').addEventListener('click', () => {
    if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
            deferredPrompt = null;
        });
    }
});

// Prevent audio pause on screen lock using the Wake Lock API
let wakeLock = null;
const requestWakeLock = async () => {
    try {
        wakeLock = await navigator.wakeLock.request('screen');
    } catch (err) {
        console.error(`${err.name}, ${err.message}`);
    }
};

const releaseWakeLock = () => {
    if (wakeLock) {
        wakeLock.release();
        wakeLock = null;
    }
};

document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible') {
        requestWakeLock();
    } else {
        releaseWakeLock();
    }
});

// Request wake lock when page is loaded
window.onload = () => {
    requestWakeLock();
};

window.onunload = () => {
    releaseWakeLock();
};

    </script>
</body>
</html>
