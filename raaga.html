<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Music Style Player</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Parkinson&display=swap" rel="stylesheet">
    <style>
        /* Add your existing styles here */
    </style>
</head>
<body>

    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
    </div>

    <div class="container" id="content">
        <!-- Your existing HTML structure here -->
    </div>

    <!-- Audio Player (Hidden) -->
    <audio id="audio" controls></audio>

    <script>
        const queries = [
            'Telugu', 'SBP', 'Devi Sri Prasad', 'Mani Sharma', 'love', 'Anoop Rubens', 
            'S. P. Balasubrahmanyam', 'Ilaiyaraaja', 'K.J. Yesudas', 'M. M. Keeravani', 
            'Annamayya Keerthana', 'G.V. Prakash Kumar', 'Anurag Kulkarni', 'Mahesh Babu', 
            'Thaman S', 'Ram Miriyala', 'Bheems Ceciroleo', 'Yuvan Shankar Raja', 
            'Ramajogayya Sastry', 'new remix'
        ];

        let audio = document.getElementById("audio");
        let playIcon = document.getElementById("play-icon");
        let songList = document.getElementById("song-list");
        let progressBar = document.getElementById("progress-bar");
        let timeDisplay = document.getElementById("time-display");
        let qualitySelect = document.getElementById("quality-select");
        let currentSongIndex = 0;
        let songs = []; // Store song data from API response
        let currentQuality = "96"; // Default to 96 kbps

        // Auto-fetch random query and play the first song on page load
        window.onload = async function() {
            const randomQuery = queries[Math.floor(Math.random() * queries.length)];
            await searchSongs(randomQuery);
        }

        // Fetch songs based on search query
        async function searchSongs(query) {
            if (!query) return;

            try {
                let url = `https://saavn.dev/api/search/songs?query=${query}&page=1&limit=10`;
                const response = await fetch(url);
                const data = await response.json();

                // Check if data exists and is valid
                if (data && data.data && data.data.results) {
                    songs = data.data.results;
                    updateSongList();
                    
                    // Auto-play the first song after fetching the song list
                    if (songs.length > 0) {
                        currentSongIndex = 0; // Set the first song as the current song
                        playSong(); // Play the first song
                    }
                } else {
                    console.error('No songs found or invalid response:', data);
                }
            } catch (error) {
                console.error('Error fetching song data:', error);
            }
        }

        // Update song list dropdown
        function updateSongList() {
            songList.innerHTML = "<option value=''>Select a song</option>";
            songs.forEach((song, index) => {
                const option = document.createElement("option");
                option.value = index;
                option.innerHTML = song.name;
                songList.appendChild(option);
            });
        }

        // Play selected song
        function playSong() {
            if (songList.value !== "") {
                currentSongIndex = songList.value;
                loadSong();
                audio.play();
            }
        }

        // Load song info
        function loadSong() {
            const song = songs[currentSongIndex];
            const selectedQuality = qualitySelect.value;
            const qualityUrl = song.downloadUrl.find(url => url.quality === `${selectedQuality}kbps`).url;

            audio.src = qualityUrl;
            document.getElementById("song-name").innerText = song.name;
            document.getElementById("song-artist").innerText = song.artists.primary[0].name;
            document.getElementById("album-name").innerText = song.album.name;
            document.getElementById("album-poster").style.backgroundImage = `url(${song.image[2].url})`;
            playIcon.innerText = "pause";
        }

        // Toggle play/pause
        function togglePlay() {
            if (audio.paused) {
                audio.play();
                playIcon.innerText = "pause";
            } else {
                audio.pause();
                playIcon.innerText = "play_arrow";
            }
        }

        // Seek song through progress bar
        function seekSong() {
            let value = progressBar.value;
            let seekTime = (audio.duration * value) / 100;
            audio.currentTime = seekTime;
        }

        // Update progress bar as song plays
        audio.ontimeupdate = function() {
            let value = (audio.currentTime / audio.duration) * 100;
            progressBar.value = value;
            let currentTime = formatTime(audio.currentTime);
            timeDisplay.innerText = currentTime;
        }

        // Format time for display
        function formatTime(seconds) {
            let min = Math.floor(seconds / 60);
            let sec = Math.floor(seconds % 60);
            if (sec < 10) sec = "0" + sec;
            return `${min}:${sec}`;
        }

        // Shuffle songs in the list
        function shufflePlaylist() {
            songs = songs.sort(() => Math.random() - 0.5);
            updateSongList();
        }

        // Download the current song
        function downloadSong() {
            const song = songs[currentSongIndex];
            const selectedQuality = qualitySelect.value;
            const qualityUrl = song.downloadUrl.find(url => url.quality === `${selectedQuality}kbps`).url;
            window.location.href = qualityUrl;
        }
    </script>

</body>
</html>
