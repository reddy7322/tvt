<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Music Style Player</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Parkinson&display=swap" rel="stylesheet">
    <style>
        /* Basic styling */
        body {
            font-family: 'Parkinson', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #121212;
            color: #fff;
        }
        .container {
            text-align: center;
            max-width: 500px;
            width: 100%;
        }
        .loader {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100vh;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .song-container {
            display: none;
            margin-top: 20px;
        }
        #album-poster {
            background-size: cover;
            background-position: center;
            width: 100px;
            height: 100px;
            margin: 10px auto;
            border-radius: 10px;
        }
        .song-info {
            margin-top: 10px;
        }
        .song-name, .song-artist, .album-name {
            margin: 5px 0;
        }
        .controls {
            margin-top: 20px;
        }
        .progress-container {
            width: 100%;
            margin: 10px 0;
        }
        progress {
            width: 100%;
        }
    </style>
</head>
<body>

    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
    </div>

    <div class="container" id="content">
        <!-- Song Information -->
        <div class="song-container" id="song-container">
            <div id="album-poster"></div>
            <div class="song-info">
                <div class="song-name" id="song-name"></div>
                <div class="song-artist" id="song-artist"></div>
                <div class="album-name" id="album-name"></div>
            </div>
            
            <!-- Audio Controls -->
            <div class="controls">
                <button onclick="togglePlay()" id="play-icon" class="material-icons">play_arrow</button>
                <progress id="progress-bar" value="0" max="100" onclick="seekSong()"></progress>
                <div id="time-display">0:00</div>
                <select id="quality-select" onchange="changeQuality()">
                    <option value="96">96 kbps</option>
                    <option value="128">128 kbps</option>
                    <option value="192">192 kbps</option>
                    <option value="320">320 kbps</option>
                </select>
                <button onclick="downloadSong()">Download</button>
            </div>

            <!-- Song List Dropdown -->
            <select id="song-list" onchange="playSong()">
                <option value="">Select a song</option>
            </select>
        </div>
    </div>

    <!-- Audio Player (Hidden) -->
    <audio id="audio" controls style="display: none;"></audio>

    <script>
        const queries = [
            'Telugu', 'SBP', 'Devi Sri Prasad', 'Mani Sharma', 'love', 'Anoop Rubens', 
            'S. P. Balasubrahmanyam', 'Ilaiyaraaja', 'K.J. Yesudas', 'M. M. Keeravani', 
            'Annamayya Keerthana', 'G.V. Prakash Kumar', 'Anurag Kulkarni', 'Mahesh Babu', 
            'Thaman S', 'Ram Miriyala', 'Bheems Ceciroleo', 'Yuvan Shankar Raja', 
            'Ramajogayya Sastry', 'new remix'
        ];

        let audio = document.getElementById("audio");
        let playIcon = document.getElementById("play-icon");
        let songList = document.getElementById("song-list");
        let progressBar = document.getElementById("progress-bar");
        let timeDisplay = document.getElementById("time-display");
        let qualitySelect = document.getElementById("quality-select");
        let currentSongIndex = 0;
        let songs = []; // Store song data from API response
        let currentQuality = "96"; // Default to 96 kbps
        const loader = document.getElementById("loader");
        const songContainer = document.getElementById("song-container");

        // Auto-fetch random query and play the first song on page load
        window.onload = async function() {
            const randomQuery = queries[Math.floor(Math.random() * queries.length)];
            await searchSongs(randomQuery);
        }

        // Fetch songs based on search query
        async function searchSongs(query) {
            if (!query) return;

            try {
                let url = `https://saavn.dev/api/search/songs?query=${query}&page=1&limit=10`;
                const response = await fetch(url);
                const data = await response.json();

                // Check if data exists and is valid
                if (data && data.data && data.data.results) {
                    songs = data.data.results;
                    updateSongList();
                    
                    // Auto-play the first song after fetching the song list
                    if (songs.length > 0) {
                        currentSongIndex = 0; // Set the first song as the current song
                        playSong(); // Play the first song
                    }

                    // Hide loader and show song container
                    loader.style.display = "none";
                    songContainer.style.display = "block";
                } else {
                    console.error('No songs found or invalid response:', data);
                }
            } catch (error) {
                console.error('Error fetching song data:', error);
            }
        }

        // Update song list dropdown
        function updateSongList() {
            songList.innerHTML = "<option value=''>Select a song</option>";
            songs.forEach((song, index) => {
                const option = document.createElement("option");
                option.value = index;
                option.innerHTML = song.name;
                songList.appendChild(option);
            });
        }

        // Play selected song
        function playSong() {
            if (songList.value !== "") {
                currentSongIndex = songList.value;
                loadSong();
                audio.play();
            }
        }

        // Load song info
        function loadSong() {
            const song = songs[currentSongIndex];
            const selectedQuality = qualitySelect.value;
            const qualityUrl = song.downloadUrl.find(url => url.quality === `${selectedQuality}kbps`).url;

            audio.src = qualityUrl;
            document.getElementById("song-name").innerText = song.name;
            document.getElementById("song-artist").innerText = song.artists.primary[0].name;
            document.getElementById("album-name").innerText = song.album.name;
            document.getElementById("album-poster").style.backgroundImage = `url(${song.image[2].url})`;
            playIcon.innerText = "pause";
        }

        // Toggle play/pause
        function togglePlay() {
            if (audio.paused) {
                audio.play();
                playIcon.innerText = "pause";
            } else {
                audio.pause();
                playIcon.innerText = "play_arrow";
            }
        }

        // Seek song through progress bar
        function seekSong() {
            let value = progressBar.value;
            let seekTime = (audio.duration * value) / 100;
            audio.currentTime = seekTime;
        }

        // Update progress bar as song plays
        audio.ontimeupdate = function() {
            let value = (audio.currentTime / audio.duration) * 100;
            progressBar.value = value;
            let currentTime = formatTime(audio.currentTime);
            timeDisplay.innerText = currentTime;
        }

        // Format time for display
        function formatTime(seconds) {
            let min = Math.floor(seconds / 60);
            let sec = Math.floor(seconds % 60);
            if (sec < 10) sec = "0" + sec;
            return `${min}:${sec}`;
        }

        // Shuffle songs in the list
        function shufflePlaylist() {
            songs = songs.sort(() => Math.random() - 0.5);
            updateSongList();
        }

        // Download the current song
        function downloadSong() {
            const song = songs[currentSongIndex];
            const selectedQuality = qualitySelect.value;
            const qualityUrl = song.downloadUrl.find(url => url.quality === `${selectedQuality}kbps`).url;
            window.location.href = qualityUrl;
        }

        // Change audio quality
        function changeQuality() {
            loadSong(); // Reload song with selected quality
        }
    </script>

</body>
</html>
